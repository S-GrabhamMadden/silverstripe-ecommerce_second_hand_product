2020-06-25 02:30

# running php upgrade inspect see: https://github.com/silverstripe/silverstripe-upgrader
cd /var/www/upgrades/ecommerce_second_hand_product
php /var/www/ss3/upgrader/vendor/silverstripe/upgrader/bin/upgrade-code inspect /var/www/upgrades/ecommerce_second_hand_product/ecommerce_second_hand_product/src  --root-dir=/var/www/upgrades/ecommerce_second_hand_product --write -vvv
Writing changes for 3 files
Running post-upgrade on "/var/www/upgrades/ecommerce_second_hand_product/ecommerce_second_hand_product/src"
[2020-06-25 14:30:29] Applying ApiChangeWarningsRule to ExportSecondHandProducts.php...
[2020-06-25 14:30:29] Applying UpdateVisibilityRule to ExportSecondHandProducts.php...
[2020-06-25 14:30:29] Applying ApiChangeWarningsRule to ControllerPermissionChecker.php...
[2020-06-25 14:30:29] Applying UpdateVisibilityRule to ControllerPermissionChecker.php...
[2020-06-25 14:30:29] Applying ApiChangeWarningsRule to UpdateSecondHandProduct.php...
[2020-06-25 14:30:29] Applying UpdateVisibilityRule to UpdateSecondHandProduct.php...
[2020-06-25 14:30:29] Applying ApiChangeWarningsRule to SecondHandProductGroup.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to SecondHandProductGroup.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to SecondHandArchive.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to SecondHandArchive.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to SecondHandEcommerceConfigExtension.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to SecondHandEcommerceConfigExtension.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to OrderStep_DisableSecondHandProduct.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to OrderStep_DisableSecondHandProduct.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to OrderStep_RemoveSecondHandProduct.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to OrderStep_RemoveSecondHandProduct.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to GridFieldAddNewButtonOriginalPageSecondHandProduct.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to GridFieldAddNewButtonOriginalPageSecondHandProduct.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to GridFieldEditOriginalPageConfigSecondHandPage.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to GridFieldEditOriginalPageConfigSecondHandPage.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to SecondHandProductGroup_Controller.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to SecondHandProductGroup_Controller.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to SecondHandProductAdmin.php...
[2020-06-25 14:30:30] Applying UpdateVisibilityRule to SecondHandProductAdmin.php...
[2020-06-25 14:30:30] Applying ApiChangeWarningsRule to CMSPageAddController_SecondHandProducts.php...
[2020-06-25 14:30:31] Applying UpdateVisibilityRule to CMSPageAddController_SecondHandProducts.php...
[2020-06-25 14:30:31] Applying ApiChangeWarningsRule to EcommerceTaskCreateSecondHandProductManager.php...
[2020-06-25 14:30:31] Applying UpdateVisibilityRule to EcommerceTaskCreateSecondHandProductManager.php...
[2020-06-25 14:30:31] Applying ApiChangeWarningsRule to EcommerceTaskSecondHandPublishAll.php...
[2020-06-25 14:30:31] Applying UpdateVisibilityRule to EcommerceTaskSecondHandPublishAll.php...
[2020-06-25 14:30:31] Applying ApiChangeWarningsRule to SecondHandProduct.php...
[2020-06-25 14:30:31] Applying UpdateVisibilityRule to SecondHandProduct.php...
[2020-06-25 14:30:31] Applying ApiChangeWarningsRule to SecondHandProduct_Controller.php...
[2020-06-25 14:30:31] Applying UpdateVisibilityRule to SecondHandProduct_Controller.php...
[2020-06-25 14:30:31] Applying ApiChangeWarningsRule to SecondHandProductValue.php...
[2020-06-25 14:30:31] Applying UpdateVisibilityRule to SecondHandProductValue.php...
unchanged:	Control/ExportSecondHandProducts.php
Warnings for Control/ExportSecondHandProducts.php:
 - Control/ExportSecondHandProducts.php:225 file_put_contents(): Use new asset abstraction (https://docs.silverstripe.org/en/4/changelogs/4.0.0#asset-storage)
modified:	Model/Process/OrderStep_RemoveSecondHandProduct.php
@@ -70,7 +70,7 @@
                 $buyable->ArchivedByID = $order->MemberID;
                 if (is_a($buyable, Object::getCustomClass(SiteTree::class))) {
                     $buyable->write();
-                    $buyable->doPublish();
+                    $buyable->publishRecursive();
                     $buyable->deleteFromStage('Live');
                     $buyable->deleteFromStage('Stage');
                 } else {

Warnings for Model/Process/OrderStep_RemoveSecondHandProduct.php:
 - Model/Process/OrderStep_RemoveSecondHandProduct.php:73 SilverStripe\ORM\DataObject->doPublish(): Moved to SilverStripe\Versioned\Versioned->publishRecursive()
modified:	Cms/SecondHandProductAdmin.php
@@ -112,7 +112,7 @@
   */
                 if (is_a($secondHandProduct, SilverStripe\Core\Injector\Injector::inst()->getCustomClass(SiteTree::class))) {
                     $secondHandProduct->write();
-                    $secondHandProduct->doPublish();
+                    $secondHandProduct->publishRecursive();
                     $secondHandProduct->deleteFromStage('Live');
                     $secondHandProduct->deleteFromStage('Stage');
                 } else if($secondHandProduct) {

Warnings for Cms/SecondHandProductAdmin.php:
 - Cms/SecondHandProductAdmin.php:115 SilverStripe\ORM\DataObject->doPublish(): Moved to SilverStripe\Versioned\Versioned->publishRecursive()
unchanged:	Cms/CMSPageAddController_SecondHandProducts.php
Warnings for Cms/CMSPageAddController_SecondHandProducts.php:
 - Cms/CMSPageAddController_SecondHandProducts.php:113 SilverStripe\Forms\Formfield->dontEscape: FormField::$dontEscape has been removed. Escaping is now managed on a class by class basis.
modified:	SecondHandProduct.php
@@ -331,7 +331,7 @@

     public function onBeforeDelete()
     {
-        if (Versioned::current_stage() !== 'Stage') {
+        if (Versioned::get_stage() !== 'Stage') {
             //do nothing
         } else {
             //page is being deleted permanently so create archived version
@@ -783,7 +783,7 @@
         DB::query('Update \"Product\" SET AllowPurchase = 0 WHERE \"Product\".\"ID\" = '.$this->ID);
         DB::query('Update \"Product_Live\" SET AllowPurchase = 0 WHERE \"Product_Live\".\"ID\" = '.$this->ID);
         $this->writeToStage('Stage');
-        $this->doPublish();
+        $this->publishRecursive();
     }

     public function exportFields()

Warnings for SecondHandProduct.php:
 - SecondHandProduct.php:497 SilverStripe\Forms\HeaderField: Requires an explicit $name constructor argument (in addition to $title)
 - SecondHandProduct.php:334 SilverStripe\Versioned\Versioned::current_stage(): Moved to SilverStripe\Versioned\Versioned::get_stage()
 - SecondHandProduct.php:786 SilverStripe\ORM\DataObject->doPublish(): Moved to SilverStripe\Versioned\Versioned->publishRecursive()
Writing changes for 3 files
✔✔✔